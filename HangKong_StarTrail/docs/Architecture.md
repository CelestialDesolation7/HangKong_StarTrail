# 星穹轨道 —— 项目架构文档

## 版本历史
| 版本号 | 日期 | 描述 |
| --- | --- | --- |
| v1.1 | 2025-04-27 | 补充模块实现进度与阶段成果 |
| v1.0 | 2025-04-27 | 初始版本 |

## 目录
1. [概述](#概述)
2. [系统设计](#系统设计)
3. [技术栈](#技术栈)
4. [模块划分](#模块划分)
5. [数据流](#数据流)
6. [部署策略](#部署策略)

## 概述

"星穹轨道"是一个基于C#和WPF框架开发的桌面应用程序，旨在通过可视化方式展示恒星运行轨迹、星系结构以及宇宙相关知识。系统采用MVVM架构模式，结合3D渲染技术，为用户提供沉浸式的宇宙探索体验。

### 设计原则

1. **模块化设计**：将系统功能划分为独立模块，便于开发和维护
2. **可扩展性**：预留扩展接口，支持未来功能增强
3. **高性能**：优化3D渲染和数据处理，确保流畅用户体验
4. **用户友好**：直观的用户界面设计，降低学习门槛

## 系统设计

### 整体架构

"星穹轨道"采用基于MVVM（Model-View-ViewModel）的分层架构：

1. **表示层**：负责用户界面和交互
   - WPF UI组件
   - 自定义控件
   - 用户输入处理

2. **业务逻辑层**：处理核心业务逻辑
   - 天体运动计算
   - 数据分析和处理
   - 用户学习进度管理

3. **数据层**：管理数据存取和持久化
   - 天文数据管理
   - 用户数据存储
   - 外部数据接口

4. **基础设施层**：提供通用功能支持
   - 3D渲染引擎
   - 日志记录
   - 配置管理
   - 网络通信

### 系统组件关系图

```
+------------------------+
|      表示层 (UI)        |
+------------------------+
           ↑↓
+------------------------+
|    业务逻辑层 (BLL)     |
+------------------------+
           ↑↓
+------------------------+
|      数据层 (DAL)       |
+------------------------+
           ↑↓
+------------------------+
|     基础设施层          |
+------------------------+
```

## 技术栈

### 开发环境
- **开发语言**：C# (.NET 8.0)
- **IDE**：Visual Studio 2022
- **构建工具**：MSBuild
- **版本控制**：Git

### 前端技术
- **UI框架**：WPF (Windows Presentation Foundation)
- **样式设计**：XAML, Material Design风格
- **3D渲染**：
  - HelixToolkit.WPF（基础3D渲染）
  - SharpDX（高级图形效果）
- **数据可视化**：
  - OxyPlot（图表绘制）
  - LiveCharts（动态数据展示）

### 后端技术
- **数据存储**：
  - SQLite（本地数据存储）
  - JSON文件（配置和小型数据）
- **天文计算**：
  - NOVAS-COM（天文学计算库）
  - 自定义物理引擎（轨道计算）
- **数据获取**：
  - RESTful API（连接在线天文数据源）
  - WebClient（数据下载）

### 第三方库
- **Prism**：MVVM框架实现
- **Unity Container**：依赖注入
- **NLog**：日志记录
- **Newtonsoft.Json**：JSON序列化/反序列化
- **Dapper**：数据库访问
- **MahApps.Metro**：现代UI控件

## 模块划分

### 1. 核心模块（Core）
- **项目命名空间**：`HangKong_StarTrail.Core`
- **职责**：提供基础服务和公共组件
- **组件**：
  - 事件聚合器
  - 导航服务
  - 通用工具类
  - 常量定义

### 2. 恒星运行模拟模块（Simulation）
- **项目命名空间**：`HangKong_StarTrail.Simulation`
- **职责**：实现恒星和行星运动的物理模拟
- **组件**：
  - 天体物理引擎
  - 轨道计算器
  - 时间控制器
  - 天体数据模型

### 3. 3D可视化模块（Visualization）
- **项目命名空间**：`HangKong_StarTrail.Visualization`
- **职责**：处理3D场景渲染和视角控制
- **组件**：
  - 场景管理器
  - 天体渲染器
  - 相机控制器
  - 材质管理器
  - 特效系统

### 4. 数据管理模块（Data）
- **项目命名空间**：`HangKong_StarTrail.Data`
- **职责**：管理天文数据和用户数据
- **组件**：
  - 数据访问服务
  - 数据同步管理器
  - 查询优化器
  - 缓存系统

### 5. 用户界面模块（UI）
- **项目命名空间**：`HangKong_StarTrail.UI`
- **职责**：实现用户界面和交互逻辑
- **组件**：
  - 主窗口
  - 控制面板
  - 信息展示区
  - 自定义控件
  - 交互命令

### 6. 知识学习模块（Education）
- **项目命名空间**：`HangKong_StarTrail.Education`
- **职责**：提供宇宙知识学习功能
- **组件**：
  - 教程系统
  - 知识库
  - 测验引擎
  - 学习进度跟踪器

## 模块实现进度
- 核心模块(Core)：基础服务与工具类已实现，事件聚合与导航服务可用
- 恒星运行模拟(Simulation)：行星轨道物理模拟、轨道动画与时间控制已实现
- 3D可视化(Visualization)：星体渲染、相机控制、材质与特效系统初步完成
- 数据管理(Data)：天体数据本地管理与基础查询已实现
- 用户界面(UI)：主窗口、操作面板、信息展示区等主要UI组件已完成
- 知识学习(Education)：模块结构已搭建，后续将补充教程与测验功能

[TODO: Confirm with team] 各模块进度与后续计划需团队进一步确认。

## 数据流

### 主要数据流程图

```
+----------------+    天体数据    +----------------+
|                |-------------->|                |
|  数据管理模块   |               |  恒星运行模拟   |
|                |<--------------|                |
+----------------+    计算结果    +----------------+
        |                                |
        | 处理后的数据                    | 物理模型
        v                                v
+----------------+    场景数据    +----------------+
|                |-------------->|                |
|  3D可视化模块   |               |    用户界面     |
|                |<--------------|                |
+----------------+    用户输入    +----------------+
                                        |
                                        | 用户操作
                                        v
                               +----------------+
                               |                |
                               |  知识学习模块   |
                               |                |
                               +----------------+
```

### 关键数据流程

1. **天体数据加载流程**：
   - 数据管理模块从本地或远程数据源加载天体数据
   - 数据传递给恒星运行模拟模块进行物理计算
   - 计算结果传递给3D可视化模块进行渲染

2. **用户交互流程**：
   - 用户界面接收用户输入
   - 输入命令传递到相应的处理模块
   - 处理结果反馈到用户界面

3. **学习内容展示流程**：
   - 知识学习模块从数据管理模块获取学习内容
   - 内容根据用户学习进度进行个性化处理
   - 处理后的内容通过用户界面展示给用户

## 部署策略

### 开发环境部署
- **开发机器要求**：
  - Windows 10/11操作系统
  - Visual Studio 2022
  - .NET 8.0 SDK
  - Git客户端
  - 至少8GB RAM和独立显卡

### 测试环境部署
- **测试环境要求**：
  - Windows 10/11操作系统
  - .NET 8.0 Runtime
  - 测试数据集
  - 性能监控工具

### 生产环境部署
- **用户设备最低要求**：
  - Windows 10/11操作系统
  - .NET 8.0 Desktop Runtime
  - 4GB RAM
  - DirectX 11兼容显卡
  - 500MB可用磁盘空间

### 发布方式
- 提供安装包（MSI）和绿色免安装版本
- 通过自动更新服务提供版本更新
- 提供可选的天文数据包下载

[TODO: 更新具体部署流程和自动化构建配置] 