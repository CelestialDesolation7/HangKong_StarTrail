<Window x:Class="HangKong_StarTrail.Views.ChatWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:HangKong_StarTrail.Views"
        xmlns:fontAwesome="clr-namespace:FontAwesome.WPF;assembly=FontAwesome.WPF"
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        mc:Ignorable="d"
        Title="星际智者 - AI对话" 
        Height="720" Width="1280"
        WindowStartupLocation="CenterScreen"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent">

    <Window.Resources>
        <!-- 转换器 -->
        <local:StringToBooleanConverter x:Key="BooleanConverter"/>
        
        <!-- 定义本地颜色资源 -->
        <Color x:Key="DeepSpaceBlue">#292841</Color>
        <Color x:Key="StarLightWhite">#F0F0F0</Color>
        <Color x:Key="HeaderBackground">#1F1E33</Color>
        <Color x:Key="PanelBackground">#232238</Color>
        <Color x:Key="UserMessageColor">#3A3D65</Color>
        <Color x:Key="AIMessageColor">#2A244A</Color>
        
        <SolidColorBrush x:Key="DeepSpaceBlueBrush" Color="{StaticResource DeepSpaceBlue}"/>
        <SolidColorBrush x:Key="StarLightWhiteBrush" Color="{StaticResource StarLightWhite}"/>
        <SolidColorBrush x:Key="HeaderBackgroundBrush" Color="{StaticResource HeaderBackground}"/>
        <SolidColorBrush x:Key="PanelBackgroundBrush" Color="{StaticResource PanelBackground}"/>
        <SolidColorBrush x:Key="UserMessageBrush" Color="{StaticResource UserMessageColor}"/>
        <SolidColorBrush x:Key="AIMessageBrush" Color="{StaticResource AIMessageColor}"/>
        
        <!-- 按钮样式 -->
        <Style x:Key="ChatButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#4169E1"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="15,8"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="5">
                            <ContentPresenter HorizontalAlignment="Center" 
                                            VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#5F79F1"/>
                                <Setter Property="Effect">
                                    <Setter.Value>
                                        <DropShadowEffect ShadowDepth="0" BlurRadius="10" Color="#4169E1" Opacity="0.6"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="#3A5BD1"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Background" Value="#2A3A61"/>
                                <Setter Property="Foreground" Value="#88FFFFFF"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- 图标按钮样式 -->
        <Style x:Key="IconButtonStyle" TargetType="Button">
            <Setter Property="Width" Value="30"/>
            <Setter Property="Height" Value="30"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                BorderThickness="{TemplateBinding BorderThickness}"
                                BorderBrush="{TemplateBinding BorderBrush}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#33FFFFFF"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- 聊天气泡样式 -->
        <Style x:Key="UserMessageStyle" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource UserMessageBrush}"/>
            <Setter Property="BorderBrush" Value="#4A4D75"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="10,10,2,10"/>
            <Setter Property="Padding" Value="15,10"/>
            <Setter Property="Margin" Value="10,5,80,5"/>
            <Setter Property="HorizontalAlignment" Value="Left"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect ShadowDepth="2" Direction="315" Opacity="0.2" BlurRadius="4"/>
                </Setter.Value>
            </Setter>
        </Style>
        
        <Style x:Key="AIMessageStyle" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource AIMessageBrush}"/>
            <Setter Property="BorderBrush" Value="#3F3460"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="10,10,10,2"/>
            <Setter Property="Padding" Value="15,10"/>
            <Setter Property="Margin" Value="80,5,10,5"/>
            <Setter Property="HorizontalAlignment" Value="Right"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect ShadowDepth="2" Direction="315" Opacity="0.2" BlurRadius="4"/>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- 输入框样式 -->
        <Style x:Key="ChatInputStyle" TargetType="TextBox">
            <Setter Property="Background" Value="#1E1E2E"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#3F3D5C"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="AcceptsReturn" Value="True"/>
            <Setter Property="TextWrapping" Value="Wrap"/>
            <Setter Property="VerticalScrollBarVisibility" Value="Auto"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="10">
                            <ScrollViewer x:Name="PART_ContentHost" Margin="{TemplateBinding Padding}"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- 提示按钮样式 -->
        <Style x:Key="PromptButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#252042"/>
            <Setter Property="Foreground" Value="#D0D0F0"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#3F3660"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="15">
                            <ContentPresenter HorizontalAlignment="Center" 
                                            VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#353265"/>
                                <Setter Property="BorderBrush" Value="#4F46A0"/>
                                <Setter Property="Effect">
                                    <Setter.Value>
                                        <DropShadowEffect ShadowDepth="0" BlurRadius="5" Color="#6F56E0" Opacity="0.3"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Border CornerRadius="10">
        <Border.Background>
            <SolidColorBrush Color="{StaticResource DeepSpaceBlue}"/>
        </Border.Background>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="30"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- 标题栏 -->
            <Grid Grid.Row="0" Background="{StaticResource HeaderBackgroundBrush}" MouseDown="TitleBar_MouseDown">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Text="星际智者 - AI对话" Foreground="{StaticResource StarLightWhiteBrush}" FontSize="14" Margin="10,5,0,0" VerticalAlignment="Center"/>

                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right">
                    <Button x:Name="MinimizeButton" Click="MinimizeButton_Click" Style="{StaticResource IconButtonStyle}">
                        <fontAwesome:FontAwesome Icon="Minus" Foreground="{StaticResource StarLightWhiteBrush}" FontSize="14"/>
                    </Button>
                    <Button x:Name="CloseButton" Click="CloseButton_Click" Style="{StaticResource IconButtonStyle}">
                        <fontAwesome:FontAwesome Icon="Close" Foreground="{StaticResource StarLightWhiteBrush}" FontSize="14"/>
                    </Button>
                </StackPanel>
            </Grid>

            <!-- 主内容区 -->
            <Grid Grid.Row="1">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- 聊天历史 -->
                <ScrollViewer x:Name="ChatScrollViewer" Grid.Row="0" Margin="5" VerticalScrollBarVisibility="Auto">
                    <StackPanel x:Name="ChatHistoryPanel">
                        <!-- 欢迎消息 -->
                        <Border Style="{StaticResource AIMessageStyle}">
                            <TextBlock Text="欢迎来到星际智者！我是您的AI助手，可以回答任何关于宇宙、星系和天文学的问题。您想了解什么呢？" 
                                       Foreground="White" TextWrapping="Wrap"/>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
                
                <!-- 快捷提示区 -->
                <ScrollViewer Grid.Row="1" HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled" Margin="10,5">
                    <StackPanel Orientation="Horizontal">
                        <Button Content="介绍一下银河系" Style="{StaticResource PromptButtonStyle}" Click="Prompt_Click"/>
                        <Button Content="太阳系八大行星" Style="{StaticResource PromptButtonStyle}" Click="Prompt_Click"/>
                        <Button Content="黑洞是什么" Style="{StaticResource PromptButtonStyle}" Click="Prompt_Click"/>
                        <Button Content="宇宙大爆炸理论" Style="{StaticResource PromptButtonStyle}" Click="Prompt_Click"/>
                        <Button Content="暗物质与暗能量" Style="{StaticResource PromptButtonStyle}" Click="Prompt_Click"/>
                        <Button Content="恒星演化过程" Style="{StaticResource PromptButtonStyle}" Click="Prompt_Click"/>
                    </StackPanel>
                </ScrollViewer>
                
                <!-- 输入区 -->
                <Grid Grid.Row="2" Margin="10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <TextBox x:Name="MessageInput" Grid.Column="0" Style="{StaticResource ChatInputStyle}" 
                             MinHeight="50" MaxHeight="100" KeyDown="MessageInput_KeyDown">
                        <TextBox.Resources>
                            <VisualBrush x:Key="PlaceholderBrush" TileMode="None" Opacity="0.5" Stretch="None" AlignmentX="Left">
                                <VisualBrush.Visual>
                                    <TextBlock Text="输入您的问题..." Foreground="#99FFFFFF" FontStyle="Italic" />
                                </VisualBrush.Visual>
                            </VisualBrush>
                        </TextBox.Resources>
                        <TextBox.Style>
                            <Style TargetType="TextBox" BasedOn="{StaticResource ChatInputStyle}">
                                <Style.Triggers>
                                    <Trigger Property="Text" Value="">
                                        <Setter Property="Background" Value="{StaticResource PlaceholderBrush}" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </TextBox.Style>
                    </TextBox>
                    
                    <Button x:Name="SendButton" Grid.Column="1" Content="发送" 
                            Style="{StaticResource ChatButtonStyle}" Click="SendButton_Click">
                        <Button.ContentTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <fontAwesome:FontAwesome Icon="PaperPlane" Margin="0,0,5,0"/>
                                    <TextBlock Text="{Binding}"/>
                                </StackPanel>
                            </DataTemplate>
                        </Button.ContentTemplate>
                    </Button>
                </Grid>
                
                <!-- 加载动画 -->
                <Grid x:Name="LoadingIndicator" Grid.Row="2" Visibility="Collapsed" 
                      Background="#66000000" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
                    <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Orientation="Horizontal">
                        <TextBlock Text="AI正在思考" Foreground="White" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <ItemsControl>
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel Orientation="Horizontal"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Ellipse Width="8" Height="8" Fill="White" Margin="2">
                                        <Ellipse.RenderTransform>
                                            <TranslateTransform x:Name="EllipseTransform" Y="0"/>
                                        </Ellipse.RenderTransform>
                                        <Ellipse.Triggers>
                                            <EventTrigger RoutedEvent="Ellipse.Loaded">
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <DoubleAnimation 
                                                            Storyboard.TargetProperty="(Ellipse.RenderTransform).(TranslateTransform.Y)" 
                                                            From="0" To="-10" Duration="0:0:0.5" 
                                                            AutoReverse="True" RepeatBehavior="Forever"/>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </EventTrigger>
                                        </Ellipse.Triggers>
                                    </Ellipse>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                            <sys:Int32>0</sys:Int32>
                            <sys:Int32>1</sys:Int32>
                            <sys:Int32>2</sys:Int32>
                        </ItemsControl>
                    </StackPanel>
                </Grid>
            </Grid>
        </Grid>
    </Border>
</Window> 